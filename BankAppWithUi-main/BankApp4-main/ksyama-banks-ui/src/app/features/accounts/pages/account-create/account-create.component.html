<div class="card p-3">
  <h4>Create Account</h4>
  <app-status-message type="success" [message]="successMessage"></app-status-message>
  <app-status-message type="danger" [message]="errorMessage"></app-status-message>

  <form [formGroup]="form" (ngSubmit)="openConfirmDialog()" class="row g-3" novalidate>
    <div class="col-md-6">
      <label class="form-label" for="holder-name">Holder Name</label>
      <input id="holder-name" class="form-control" formControlName="holderName" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.holderName.dirty || form.controls.holderName.touched) && form.controls.holderName.hasError('required')">
        Holder name is required.
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label" for="pan-number">PAN Number</label>
      <input id="pan-number" class="form-control text-uppercase" formControlName="panNumber" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.panNumber.dirty || form.controls.panNumber.touched) && form.controls.panNumber.hasError('required')">PAN number is required.</div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.panNumber.dirty || form.controls.panNumber.touched) && form.controls.panNumber.hasError('pattern')">Use valid PAN format (ABCDE1234F).</div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.panNumber.dirty || form.controls.panNumber.touched) && form.controls.panNumber.hasError('duplicate')">This PAN number already exists.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label" for="email">Email</label>
      <input id="email" class="form-control" formControlName="email" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.email.dirty || form.controls.email.touched) && form.controls.email.hasError('required')">Email is required.</div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.email.dirty || form.controls.email.touched) && form.controls.email.hasError('email')">Enter a valid email address.</div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.email.dirty || form.controls.email.touched) && form.controls.email.hasError('duplicate')">This email already exists.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label" for="mobile-number">Mobile Number</label>
      <input id="mobile-number" class="form-control" formControlName="mobileNumber" maxlength="10" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.mobileNumber.dirty || form.controls.mobileNumber.touched) && form.controls.mobileNumber.hasError('required')">Mobile number is required.</div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.mobileNumber.dirty || form.controls.mobileNumber.touched) && form.controls.mobileNumber.hasError('pattern')">Mobile number must be 10 digits.</div>
    </div>

    <div class="col-md-6">
      <label class="form-label" for="initial-balance">Initial Balance</label>
      <input id="initial-balance" class="form-control" type="number" min="0.01" step="0.01" formControlName="initialBalance" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.initialBalance.dirty || form.controls.initialBalance.touched) && form.controls.initialBalance.hasError('required')">
        Initial balance is required.
      </div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.initialBalance.dirty || form.controls.initialBalance.touched) && (form.controls.initialBalance.hasError('min') || form.controls.initialBalance.hasError('minAmount'))">
        Initial balance must be greater than ₹0.00.
      </div>
    </div>
    <div class="col-12 d-flex flex-wrap gap-2">
      <button class="btn btn-primary" [disabled]="isSubmitting || form.invalid" type="submit">
        {{ isSubmitting ? 'Creating...' : 'Create Account' }}
      </button>
      <button class="btn btn-outline-secondary" [disabled]="isSubmitting" type="button" (click)="resetForm()">Reset Form</button>
    </div>
  </form>
</div>

<div class="dialog-backdrop" *ngIf="confirmDialogOpen">
  <div class="dialog-card">
    <h5 class="mb-3">Confirm account creation</h5>
    <p class="mb-1"><strong>Holder:</strong> {{ form.controls.holderName.value }}</p>
    <p class="mb-1"><strong>PAN:</strong> {{ form.controls.panNumber.value }}</p>
    <p class="mb-1"><strong>Email:</strong> {{ form.controls.email.value }}</p>
    <p class="mb-1"><strong>Mobile:</strong> {{ form.controls.mobileNumber.value }}</p>
    <p class="mb-3"><strong>Initial balance:</strong> ₹{{ form.controls.initialBalance.value }}</p>
    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="closeConfirmDialog()">Cancel</button>
      <button class="btn btn-primary" type="button" [disabled]="isSubmitting" (click)="submit()">Confirm & Create</button>
    </div>
  </div>
</div>
