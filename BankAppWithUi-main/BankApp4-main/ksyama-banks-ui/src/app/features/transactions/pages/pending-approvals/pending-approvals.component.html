<div class="card p-3">
  <div class="d-flex justify-content-between align-items-center">
    <h4>Pending Withdrawals</h4>
    <button class="btn btn-outline-secondary btn-sm" [disabled]="loading" (click)="load()">Refresh</button>
  </div>
  <div class="my-2" *ngIf="pending.length > 0">
    <span class="badge text-bg-danger">{{ pending.length }} pending approval request(s)</span>
  </div>
  <app-status-message type="danger" [message]="errorMessage"></app-status-message>

  <div *ngIf="loading">Loading pending approvals...</div>

  <table class="table table-sm" *ngIf="!loading">
    <tr><th>ID</th><th>Account</th><th>Amount</th><th>Status</th><th>Action</th></tr>
    <tr *ngFor="let txn of pending">
      <td>{{ txn.id }}</td>
      <td>{{ txn.accountNumber }}</td>
      <td>{{ txn.amount }}</td>
      <td>{{ txn.status }}</td>
      <td class="d-flex gap-2">
        <button class="btn btn-success btn-sm" [disabled]="actionInProgressId !== null" (click)="approve(txn.id)">
          {{ actionInProgressId === txn.id ? 'Approving...' : 'Approve' }}
        </button>
        <button class="btn btn-danger btn-sm" [disabled]="actionInProgressId !== null" (click)="reject(txn.id)">
          {{ actionInProgressId === txn.id ? 'Rejecting...' : 'Reject' }}
        </button>
      </td>
    </tr>
  </table>
</div>

<div class="dialog-backdrop" *ngIf="selectedTransaction && pendingAction">
  <div class="dialog-card">
    <h5 class="mb-2">{{ pendingAction === 'approve' ? 'Approve' : 'Reject' }} withdrawal request</h5>
    <p class="mb-1"><strong>Request ID:</strong> #{{ selectedTransaction.id }}</p>
    <p class="mb-1"><strong>Account:</strong> {{ selectedTransaction.accountNumber }}</p>
    <p class="mb-1"><strong>Amount:</strong> â‚¹{{ selectedTransaction.amount | number:'1.2-2' }}</p>
    <p class="mb-3"><strong>Status:</strong> {{ selectedTransaction.status }}</p>
    <p class="text-warning small">Please review the above details before continuing.</p>
    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="cancelAction()">Cancel</button>
      <button class="btn" [ngClass]="pendingAction === 'approve' ? 'btn-success' : 'btn-danger'" type="button" [disabled]="actionInProgressId !== null" (click)="confirmAction()">
        Confirm {{ pendingAction === 'approve' ? 'Approval' : 'Rejection' }}
      </button>
    </div>
  </div>
</div>
