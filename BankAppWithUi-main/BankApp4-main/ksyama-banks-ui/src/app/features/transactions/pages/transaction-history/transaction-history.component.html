<div class="card p-3">
  <h4>Transaction History</h4>
  <app-status-message type="danger" [message]="errorMessage"></app-status-message>

  <form [formGroup]="form" (ngSubmit)="search()" class="row g-2 mb-3" novalidate>
    <div class="col-md-8">
      <label class="form-label" for="history-account">Account Number</label>
      <input id="history-account" class="form-control" placeholder="Account Number" formControlName="accountNumber" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.accountNumber.dirty || form.controls.accountNumber.touched) && form.controls.accountNumber.hasError('required')">
        Account number is required.
      </div>
    </div>
    <div class="col-md-4 d-flex align-items-end"><button class="btn btn-primary w-100" [disabled]="loading || form.invalid">{{ loading ? 'Loading...' : 'Load History' }}</button></div>
  </form>

  <table class="table table-sm table-hover align-middle" *ngIf="transactions.length">
    <tr><th>ID</th><th>Type</th><th>Amount</th><th>Status</th><th>Performed By</th><th>Timestamp</th></tr>
    <tr *ngFor="let txn of pagedTransactions">
      <td>{{ txn.id }}</td>
      <td>{{ txn.type }}</td>
      <td>{{ txn.amount }}</td>
      <td><span class="badge rounded-pill" [ngClass]="getStatusClass(txn.status)">{{ txn.status }}</span></td>
      <td>{{ txn.performedBy || 'SYSTEM' }}</td>
      <td>{{ txn.timestamp | date : 'medium' }}</td>
    </tr>
  </table>
  <div class="d-flex justify-content-end gap-2" *ngIf="transactions.length > pageSize">
    <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()" [disabled]="page===1">Prev</button>
    <span class="small align-self-center">Page {{ page }} / {{ totalPages }}</span>
    <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()" [disabled]="page===totalPages">Next</button>
  </div>

  <div class="text-muted fw-semibold" *ngIf="hasSearched && !loading && !errorMessage && !transactions.length">
    null
  </div>
</div>
