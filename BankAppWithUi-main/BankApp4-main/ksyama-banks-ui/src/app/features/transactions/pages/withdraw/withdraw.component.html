<div class="card p-3 app-card">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h4 class="mb-0">Withdraw</h4>
    <button class="btn btn-outline-secondary btn-sm" type="button" [disabled]="isSubmitting" (click)="refreshSection()">Refresh</button>
  </div>

  <p class="text-muted small mb-2">Withdrawals above ₹{{ managerApprovalLimit | number : '1.0-0' }} require manager approval.</p>
  <app-status-message type="success" [message]="successMessage"></app-status-message>
  <app-status-message type="danger" [message]="errorMessage"></app-status-message>

  <form [formGroup]="form" (ngSubmit)="submit()" class="row g-3" novalidate>
    <div class="col-md-6">
      <label class="form-label" for="withdraw-account">Account Number</label>
      <input id="withdraw-account" class="form-control" formControlName="accountNumber" (blur)="checkBalance()" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.accountNumber.dirty || form.controls.accountNumber.touched) && form.controls.accountNumber.hasError('required')">
        Account number is required.
      </div>
    </div>
    <div class="col-md-6">
      <label class="form-label" for="withdraw-amount">Amount</label>
      <input id="withdraw-amount" type="number" min="0.01" step="0.01" class="form-control" formControlName="amount" />
      <div class="text-danger small mt-1" *ngIf="(form.controls.amount.dirty || form.controls.amount.touched) && (form.controls.amount.hasError('required') || form.controls.amount.hasError('number'))">
        Enter a valid numeric amount.
      </div>
      <div class="text-danger small mt-1" *ngIf="(form.controls.amount.dirty || form.controls.amount.touched) && (form.controls.amount.hasError('min') || form.controls.amount.hasError('minAmount'))">
        Amount must be greater than ₹0.00.
      </div>
      <div class="text-danger small mt-1" *ngIf="form.controls.amount.hasError('insufficientBalance')">
        Insufficient balance for this withdrawal.
      </div>
      <div class="text-muted small mt-1" *ngIf="availableBalance !== null">
        Available balance: ₹{{ availableBalance | number:'1.2-2' }}
      </div>
      <div class="text-warning small mt-1" *ngIf="getAmountWarning()">
        {{ getAmountWarning() }}
      </div>
    </div>
    <div class="col-12 d-flex gap-2">
      <button class="btn btn-primary" [disabled]="isSubmitting || form.invalid" type="submit">{{ isSubmitting ? 'Processing...' : 'Withdraw' }}</button>
      <button class="btn btn-outline-secondary" type="button" [disabled]="isSubmitting" (click)="refreshSection()">Reset</button>
    </div>
  </form>
</div>

<div class="dialog-backdrop" *ngIf="showConfirmDialog">
  <div class="dialog-card">
    <h5 class="mb-2">Confirm withdrawal</h5>
    <p class="mb-1" *ngIf="pendingPayload">
      Withdraw <strong>₹{{ pendingPayload.amount | number:'1.2-2' }}</strong> from account
      <strong>{{ pendingPayload.accountNumber }}</strong>?
    </p>
    <p class="small text-muted mb-3">{{ approvalHint }}</p>
    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" type="button" (click)="cancelSubmit()">Cancel</button>
      <button class="btn btn-primary" type="button" (click)="confirmSubmit()">Confirm</button>
    </div>
  </div>
</div>
